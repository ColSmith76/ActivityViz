!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3"),require("d3fc-rebind")):"function"==typeof define&&define.amd?define(["exports","d3","d3fc-rebind"],n):n(t.fc_label_layout=t.fc_label_layout||{},t.d3,t.fc_rebind)}(this,function(t,n,e){"use strict";function r(t){var r=function(){},i=n.functor([0,0]),u=function(t,n){return[t.x,t.y]},o=t||function(t){return t},a=function(){},h=c().selector("g.label").element("g").attr("class","label"),f=function(t){t.each(function(t,e){var c=this,f=h(this,t).call(a),l=f[0].map(function(t,e){var r=n.select(t).datum(),o=u.call(t,r,e),c=i.call(t,r,e);return{hidden:!1,x:o[0],y:o[1],width:c[0],height:c[1]}}),d=o(l);f.attr({style:function(t,n){return"display:"+(d[n].hidden?"none":"inherit")},transform:function(t,n){return"translate("+d[n].x+", "+d[n].y+")"},"layout-width":function(t,n){return d[n].width},"layout-height":function(t,n){return d[n].height},"anchor-x":function(t,n){return u.call(c,t,n)[0]-d[n].x},"anchor-y":function(t,n){return u.call(c,t,n)[1]-d[n].y}}),f.call(a),r(f,t,e)})};return e.rebindAll(f,h,e.include("key")),e.rebindAll(f,o),f.size=function(t){return arguments.length?(i=n.functor(t),f):i},f.position=function(t){return arguments.length?(u=n.functor(t),f):u},f.component=function(t){return arguments.length?(a=t,f):a},f.decorate=function(t){return arguments.length?(r=t,f):r},f}function i(t,n,e,r,i){return{x:t,y:n,width:e,height:r,location:i}}function u(){var t=[0,0],e=function(e){var r=d(e),i=0;if(0!==t[0]&&0!==t[1]){var u={x:0,y:0,width:t[0],height:t[1]};i=n.sum(e.map(function(t){var n=t.width*t.height-f(t,u);return 2*n}))}return r+i},r=function(t){var n=[];return t.forEach(function(t){var r=s(t).map(function(t){var e=n.slice();return e.push(t),e});n=g(r,e)[1]}),n};return r.bounds=function(n){return arguments.length?(t=n,r):t},r}n="default"in n?n["default"]:n;var o=1e-6,c=function(){var t="g",e=!1,r="g",i={},u=function(t,n){return n},c=function(c,a){var h=a||function(t){return t};c.selectAll&&c.node||(c=n.select(c));var f=c.selectAll(t);e&&(f=f.filter(function(){return this.parentNode===c.node()}));var l=f.data(h,u),d=l.enter().insert(r).attr(i).style("opacity",o),g=n.transition(l.exit()).style("opacity",o).remove();return l=n.transition(l).style("opacity",1),l.enter=n.functor(d),l.exit=n.functor(g),l};return c.selector=function(n){return arguments.length?(t=n,c):t},c.children=function(t){return arguments.length?(e=t,c):e},c.element=function(t){return arguments.length?(r=t,c):r},c.attr=function(t){if(!arguments.length)return i;if(1===arguments.length)i=arguments[0];else if(2===arguments.length){var n=arguments[0],e=arguments[1];i[n]=e}return c},c.key=function(t){return arguments.length?(u=t,c):u},c},a=function(t){var e=2,r=function(t){return t},i=c().selector("text").element("text"),u=c().selector("rect").element("rect"),o=c().selector("circle").element("circle"),a=function(t){t.each(function(t,n){var c=Number(this.getAttribute("layout-width")),a=Number(this.getAttribute("layout-height")),h=u(this,[t]);h.attr({width:c,height:a});var f=Number(this.getAttribute("anchor-x")),l=Number(this.getAttribute("anchor-y")),d=o(this,[t]);d.attr({r:2,cx:f,cy:l});var g=i(this,[t]);g.enter().attr({dy:"0.9em",transform:"translate("+e+", "+e+")"}),g.text(r)})};return a.padding=function(t){return arguments.length?(e=t,a):e},a.value=function(t){return arguments.length?(r=n.functor(t),a):r},a},h=function(t,n){return!(t.x>=n.x+n.width||t.x+t.width<=n.x||t.y>=n.y+n.height||t.y+t.height<=n.y)},f=function(t,n){if(h(t,n)){var e=Math.max(t.x,n.x),r=Math.min(t.x+t.width,n.x+n.width),i=Math.max(t.y,n.y),u=Math.min(t.y+t.height,n.y+n.height);return(r-e)*(u-i)}return 0},l=function(t,e){return n.sum(t.map(function(n,r){return e===r?0:f(t[e],n)}))},d=function(t){return n.sum(t.map(function(n,e){return l(t,e)}))},g=function(t,n){return t.map(function(t,e){return[n(t,e),t,e]}).reduce(function(t,n){return t[0]>n[0]?n:t},[Number.MAX_VALUE,null,-1])},s=function(t){var n=t.x,e=t.y,r=t.width,u=t.height;return[i(n,e,r,u,"bottom-right"),i(n-r,e,r,u,"bottom-left"),i(n-r,e-u,r,u,"top-left"),i(n,e-u,r,u,"top-right"),i(n,e-u/2,r,u,"middle-right"),i(n-r/2,e,r,u,"bottom-center"),i(n-r,e-u/2,r,u,"middle-left"),i(n-r/2,e-u,r,u,"top-center")]},m=function(t){return t[y(t)]},y=function(t){return Math.floor(Math.random()*t.length)},v=function(t,n,e){var r=t.slice();return r[n]=e,r},x=function(){function t(t,n){var e=y(t),r=t[e],i=s(r),u=m(i);return v(n,e,u)}function e(t){var e=d(t),r=0;if(0!==u[0]&&0!==u[1]){var i={x:0,y:0,width:u[0],height:u[1]};r=n.sum(t.map(function(t){var n=t.width*t.height-f(t,i);return 2*n}))}var o=n.sum(t.map(function(t){var n=t.width*t.height/4;return"bottom-right"===t.location&&(n=0),"middle-right"!==t.location&&"bottom-center"!==t.location||(n/=2),n}));return e+r+o}var r=1e3,i=1,u=[0,0],o=function(n){for(var u=n,o=n,c=1/0,a=r;a>0;){var h=t(u,o),f=e(h),l=Math.exp((c-f)/a);(f<c||l>Math.random())&&(o=h,c=f),a-=i}return o};return o.temperature=function(t){return arguments.length?(r=t,o):r},o.cooling=function(t){return arguments.length?(i=t,o):i},o.bounds=function(t){return arguments.length?(u=t,o):u},o},b=function(t){t=t||function(t){return t};var n=function(n){n=t(n);var e=function(t){return function(n,e){return-l(t,e)}},r=!0;do{var i=n.filter(function(t){return!t.hidden}),u=g(i,e(i));u[0]<0?u[1].hidden=!0:r=!1}while(r);return n};return e.rebindAll(n,t),n},p=function(){var t=[0,0],n=function(n){return n.map(function(n,e){var r=n.x,i=n.y;return r+n.width>t[0]&&(r-=n.width),i+n.height>t[1]&&(i-=n.height),{height:n.height,width:n.width,x:r,y:i}})};return n.bounds=function(e){return arguments.length?(t=e,n):t},n};t.label=r,t.textLabel=a,t.greedy=u,t.annealing=x,t.removeOverlaps=b,t.boundingBox=p,t.intersect=f});