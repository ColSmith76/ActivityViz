<html>

<head>
	<title>ARC ABMVIZ</title>
	<link rel="shortcut icon" href="data/atlanta/img/arc_logo.ico">
	<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
	<script src="bower_components/jquery/dist/jquery.min.js"></script>
	<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="bower_components/d3/d3.min.js"></script>
	<script type="text/javascript">
		$.getJSON( "config.json", function (data) {
           $.each(data, function (key, val) {
               var count = 0;
               if(key =="regions") {
                   $.each(val, function (k, v) {
                       count += 1;
                       if (count == 1) {
                           $.getJSON("data/" + v + "/config.json", function (data) {
                               var icon = data.Icon;
                               var logo = data.Logo;
                               var title = data.Title;
                               var linkURL = data.LinkURL;
                               var navbartitle = data.NavbarTitle;
                               $("link[rel*='icon']").attr("href", "data/" + v + "/img/" + icon + "");
                               $("title").text(title);
                               $('#title_id').text(navbartitle);
                               $('#navbarlink').attr("href", linkURL);
                               $('#logo_id').attr("src", "data/" + v + "/img/" + logo + "");
                           });
                       }
                       $('#scenarios').append("<h4>" + k + "</h4>");
                       $('#scenarios').append("<ul id='" + v + "_scenarios' class='scenarios'> </ul>");

                       d3.csv("data/" + v + "/scenarios.csv", function (data) {
                           $.each(data, function (key, value) {
                               $("#" + v + "_scenarios").append("<li><a class='scenariolink' href='src/index.html?region=" + v + "&scenario=" + value["Scenario"] + "&visuals='>" + value["Scenario"] + value["Description"] + "</a></li>");
                           });
                       });
                   });
               } else if(key=="visualizations"){
				   $.each(val, function (k, v) {
						$('#'+k.toLowerCase()+"_id").prop("checked",v);
                   });
			   }
           });
        });

	</script>
</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-header">
			<a id="navbarlink" href="" style="padding-left:1em;padding-top:1.1em;margin-right:-.5em;" class="pull-left"><img id="logo_id" width="40" height="17" src=""></a> <a class="navbar-brand" id="title_id" href="#">.</a> </div>
	</nav>
	<div id="scenarios" style="margin:5em;">
		<h3>Please select a scenario for visualization</h3>

	</div>
	<div style="margin:5em;" id="visualizations">
        <h3>Visualizations to Display</h3>
        <div id="novizalert" class="alert alert-danger" style="display:none">Please select at least one visualization to display</div>
        <label class="checkbox-inline"><input name="3dmap" id="3dmap_id" visual='3' type="checkbox"  value="">3D Animated Map</label>
        <label class="checkbox-inline"><input name="barmap" id="barmap_id" visual='b' type="checkbox"  value="">Bar Chart with Map</label>
        <label class="checkbox-inline"><input name="grpbar" id="grpbar_id"  visual='g' type="checkbox"  value="">Grouped Bar Chart</label>
        <label class="checkbox-inline"><input name="timemap" id="timeuse_id" visual='t' type="checkbox"   value="">Time Use Map</label>
        <label class="checkbox-inline"><input name="radar" id="radar_id" visual='r' type="checkbox"  value="">Radar Charts</label>
        <label class="checkbox-inline"><input name="sunburst" id="sunburst_id" visual='s' type="checkbox"   value="">Sunburst Map</label>
	</div>

<script>
    (function() {
        $('#scenarios').on('click','a.scenariolink', function(event){
        	var total = $('#visualizations').find('input[type=checkbox]:checked').length;
        	var visuals = "";
        	$('input[type=checkbox]').each(function(event){
           		if($(this).is(':checked')){
               		visuals += $(this).attr('visual');
           		}
        	});
        	$("a.scenariolink").attr('href',function(i, h) {
           		// console.log(h);
				//return jQuery.query.set("visuals",visuals);
            	h= h.slice(0,h.indexOf('&visuals'));
            	return h +  "&visuals="+visuals;
        	});
            if(total ==0){
                event.preventDefault();
                event.stopPropagation();
                $('#novizalert').show();
            }else {

            }
        });


    $('input[type=checkbox]').on('click',function(event){
        //event.preventDefault();
        var visuals = "";
        $('input[type=checkbox]').each(function(event){
           if($(this).is(':checked')){
               visuals += $(this).attr('visual');
           }
        });
        $("a.scenariolink").attr('href',function(i, h) {
           // console.log(h);
            //return jQuery.query.set("visuals",visuals);
            h= h.slice(0,h.indexOf('&visuals'));
            return h +  "&visuals="+visuals;
        });

    });
    })();
</script>
</body>

</html>